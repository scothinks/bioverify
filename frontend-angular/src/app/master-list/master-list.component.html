<div class="master-list-container">
  <mat-card class="list-card">
    <mat-card-header class="enhanced-header">
      <div class="header-content">
        <div class="title-section">
          <mat-icon class="header-icon">list_alt</mat-icon>
          <div class="title-text">
            <mat-card-title>Master List Records</mat-card-title>
            <mat-card-subtitle>Complete employee records database</mat-card-subtitle>
          </div>
        </div>
        <div class="header-actions">
           <div class="stat-chip" *ngIf="!isLoading">
            <mat-icon>people</mat-icon>
            <span>{{dataSource.filteredData.length}} / {{dataSource.data.length}} records</span>
          </div>
          </div>
      </div>
    </mat-card-header>

    <mat-card-content class="enhanced-content">
      
      <div class="filter-controls" [formGroup]="filterForm">
        <mat-form-field appearance="outline">
          <mat-label>Filter by Ministry</mat-label>
          <mat-select formControlName="ministry" multiple>
            <mat-option *ngFor="let ministry of ministryList" [value]="ministry">
              {{ ministry }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      
        <mat-form-field appearance="outline">
          <mat-label>Filter by Department</mat-label>
          <mat-select formControlName="department" multiple>
            <mat-option *ngFor="let department of departmentList" [value]="department">
              {{ department }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      
        <mat-form-field appearance="outline">
          <mat-label>Filter by Grade</mat-label>
          <mat-select formControlName="gradeLevel" multiple>
            <mat-option *ngFor="let grade of gradeList" [value]="grade">
              {{ grade }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      
        <mat-form-field appearance="outline">
          <mat-label>Filter by Status</mat-label>
          <mat-select formControlName="status" multiple>
            <mat-option *ngFor="let status of statusList" [value]="status">
              {{ status | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      
        <button mat-stroked-button (click)="clearFilters()" class="clear-button">
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </div>

      <div *ngIf="!isLoading; else loading">
        <div class="table-container" *ngIf="dataSource.filteredData.length > 0; else noRecords">
          <div class="table-wrapper">
            <table mat-table [dataSource]="dataSource" class="enhanced-table">

              <ng-container matColumnDef="fullName">
                <th mat-header-cell *matHeaderCellDef>Employee</th>
                <td mat-cell *matCellDef="let record">
                  <div class="employee-info">
                    <div class="employee-avatar">{{getInitials(record.fullName)}}</div>
                    <span class="employee-name">{{record.fullName}}</span>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="department">
                <th mat-header-cell *matHeaderCellDef>Department</th>
                <td mat-cell *matCellDef="let record">{{record.department}}</td>
              </ng-container>

              <ng-container matColumnDef="ministry">
                <th mat-header-cell *matHeaderCellDef>Ministry</th>
                <td mat-cell *matCellDef="let record">{{record.ministry}}</td>
              </ng-container>

              <ng-container matColumnDef="gradeLevel">
                <th mat-header-cell *matHeaderCellDef>Grade</th>
                <td mat-cell *matCellDef="let record">
                  <div class="grade-badge">{{record.gradeLevel}}</div>
                </td>
              </ng-container>
              
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let record">
                  <div class="status-chip" [ngClass]="getStatusClass(record.status)">
                    <mat-icon>{{getStatusIcon(record.status)}}</mat-icon>
                    <span>{{record.status || 'Unknown' | titlecase}}</span>
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>
          <mat-paginator [pageSizeOptions]="[10, 25, 100]" showFirstLastButtons
                         aria-label="Select page of records">
          </mat-paginator>
        </div>
        <ng-template #noRecords>
          <div class="empty-state">
            <mat-icon class="empty-icon">folder_off</mat-icon>
            <h3>No Records Found</h3>
            <p>Your master list is empty or your filter returned no results.</p>
            <button mat-flat-button class="primary-button" (click)="onUploadClick()">
              <mat-icon>cloud_upload</mat-icon>
              Upload Master List
            </button>
          </div>
        </ng-template>
      </div>

      <ng-template #loading>
        <div class="loading-state">
          <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
          <p>Loading Master Records...</p>
        </div>
      </ng-template>
    </mat-card-content>
  </mat-card>
</div>