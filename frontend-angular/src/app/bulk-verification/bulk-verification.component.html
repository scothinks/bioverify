<div class="bulk-verify-header">
  <h3 class="card-title">
    <mat-icon>checklist</mat-icon>
    Bulk Verification
  </h3>
  <button mat-raised-button color="primary" (click)="startVerification()" [disabled]="isLoading">
    <mat-icon>play_circle_filled</mat-icon>
    <span>Verify All Pending Records</span>
  </button>
</div>

<div *ngIf="isLoading && jobs.length === 0" class="spinner-container">
  <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
</div>

<div *ngIf="!isLoading && jobs.length === 0" class="no-jobs-message">
  <p>No bulk verification jobs found.</p>
</div>

<table mat-table [dataSource]="jobs" *ngIf="jobs.length > 0" class="mat-elevation-z4">

  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef> Status </th>
    <td mat-cell *matCellDef="let job">
      <div class="status-cell">
        <ng-container [ngSwitch]="job.status">
          <mat-icon *ngSwitchCase="'COMPLETED'" color="primary" matTooltip="Completed">check_circle</mat-icon>
          <mat-icon *ngSwitchCase="'FAILED'" color="warn" matTooltip="Failed: {{job.statusMessage}}">error</mat-icon>
          <mat-progress-spinner *ngSwitchCase="'RUNNING'" mode="indeterminate" [diameter]="24" matTooltip="Running..."></mat-progress-spinner>
          <mat-icon *ngSwitchCase="'PENDING'" matTooltip="Pending">hourglass_empty</mat-icon>
        </ng-container>
        <span>{{ job.status | titlecase }}</span>
      </div>
    </td>
  </ng-container>

  <ng-container matColumnDef="totalRecords">
    <th mat-header-cell *matHeaderCellDef> Total </th>
    <td mat-cell *matCellDef="let job"> {{job.totalRecords}} </td>
  </ng-container>

  <ng-container matColumnDef="processed">
    <th mat-header-cell *matHeaderCellDef> Progress </th>
    <td mat-cell *matCellDef="let job"> {{job.successfullyVerifiedRecords}} / {{job.totalRecords}} </td>
  </ng-container>

  <ng-container matColumnDef="createdAt">
    <th mat-header-cell *matHeaderCellDef> Started On </th>
    <td mat-cell *matCellDef="let job"> {{job.createdAt | date:'short'}} </td>
  </ng-container>

  <ng-container matColumnDef="updatedAt">
    <th mat-header-cell *matHeaderCellDef> Last Update </th>
    <td mat-cell *matCellDef="let job"> {{job.updatedAt | date:'short'}} </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>