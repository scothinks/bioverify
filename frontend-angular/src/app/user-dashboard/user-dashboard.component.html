<div class="dashboard-container" *ngIf="userRecord; else loading">
  <div class="dashboard-grid">

    <div class="profile-column">
      <mat-card class="profile-card">
        <mat-card-header class="profile-header">
          <div class="user-avatar">{{ getInitials(userRecord.fullName) }}</div>
          <div class="header-text">
            <mat-card-title>{{ userRecord.fullName }}</mat-card-title>
            <mat-card-subtitle>Work ID: {{ userRecord.employeeId || 'Not Assigned' }}</mat-card-subtitle>
          </div>
        </mat-card-header>
        <mat-divider></mat-divider>
        <mat-card-content class="profile-content">
          <div class="detail-row">
            <span class="detail-label">Status</span>
            <span class="detail-value status-badge {{ userRecord.status }}">{{ userRecord.status | titlecase }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Email</span>
            <span class="detail-value">{{ userRecord.email || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Ministry</span>
            <span class="detail-value">{{ userRecord.ministry || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Department</span>
            <span class="detail-value">{{ userRecord.department || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Grade Level</span>
            <span class="detail-value">{{ userRecord.gradeLevel || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Last Liveness Check</span>
            <span class="detail-value">{{ userRecord.lastLivenessCheckDate ? (userRecord.lastLivenessCheckDate | date:'longDate') : 'N/A'  }}</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="actions-column">
      
      <mat-card 
        class="action-card liveness-countdown-card"
        [ngClass]="{
          'due-soon': daysRemaining !== null && daysRemaining <= 14,
          'overdue': daysRemaining !== null && daysRemaining === 0
        }"
        *ngIf="userRecord.status === 'ACTIVE' && daysRemaining !== null">
        
        <mat-card-header>
          <mat-icon mat-card-avatar>timer</mat-icon>
          <mat-card-title>Liveness Check Due</mat-card-title>
          <mat-card-subtitle>Next check required in:</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content class="countdown-content">
          <div class="days-remaining">{{ daysRemaining }}</div>
          <div class="days-label">Days</div>
          
          <div *ngIf="isLivenessCheckDue" class="liveness-action">
            <mat-divider></mat-divider>
            <p>Your action is required to keep your account active.</p>
            <app-liveness-check (checkCompleted)="onLivenessCheckCompleted()"></app-liveness-check>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="action-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>account_balance</mat-icon>
          <mat-card-title>Access Loans</mat-card-title>
          <mat-card-subtitle>Future Feature</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p>Access financial services and loan opportunities based on your verified status.</p>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-flat-button disabled>Coming Soon</button>
        </mat-card-actions>
      </mat-card>

    </div>
  </div>
</div>

<ng-template #loading>
  <div class="spinner-container">
    <mat-spinner></mat-spinner>
    <p>Loading your record...</p>
  </div>
</ng-template>