<div class="dashboard-container" *ngIf="!isLoading; else loadingSpinner">
  <mat-card class="dashboard-card" *ngIf="userRecord">
    <mat-card-header>
      <mat-card-title>Welcome, {{ userRecord.fullName }}</mat-card-title>
      <mat-card-subtitle>Your Personal Dashboard</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      
      <div class="status-display">
        <span>Verification Status:</span>
        <span class="status-badge" [ngClass]="'status-' + userRecord.status.toLowerCase()">
          {{ userRecord.status.replace('_', ' ') }}
        </span>
      </div>

      <div *ngIf="userRecord.status === 'VERIFIED_PENDING_CONFIRMATION' && !successMessage" class="confirmation-panel">
        <hr>
        <h3>Please Review Your Details</h3>
        <p>Confirm that the following information is correct to finalize your verification.</p>
        <mat-list role="list">
          <mat-list-item role="listitem"><strong>Full Name:</strong> {{ userRecord.fullName }}</mat-list-item>
          <mat-list-item role="listitem"><strong>Business Unit:</strong> {{ userRecord.businessUnit }}</mat-list-item>
          <mat-list-item role="listitem"><strong>Grade Level:</strong> {{ userRecord.gradeLevel }}</mat-list-item>
        </mat-list>
        <div class="confirmation-actions">
          <button mat-stroked-button color="warn">Details are Incorrect</button>
          <button mat-raised-button color="primary" (click)="onConfirmDetails()" [disabled]="isConfirming">
             <mat-spinner *ngIf="isConfirming" diameter="20"></mat-spinner>
             <span *ngIf="!isConfirming">Confirm Details</span>
          </button>
        </div>
      </div>

      <div *ngIf="successMessage" class="success-message">
        <mat-icon color="primary">check_circle</mat-icon>
        <span>{{ successMessage }}</span>
      </div>

    </mat-card-content>
  </mat-card>
</div>

<ng-template #loadingSpinner>
  <div class="spinner-container">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>