<div class="dashboard-container" *ngIf="userRecord; else loading">
  <div class="dashboard-grid">

    <div class="profile-column">
      <mat-card class="profile-card">
        <mat-card-header class="profile-header">
          <div class="user-avatar">{{ getInitials(userRecord.fullName) }}</div>
          <div class="header-text">
            <mat-card-title>{{ userRecord.fullName }}</mat-card-title>
            <mat-card-subtitle>Work ID: {{ userRecord.employeeId || 'Not Assigned' }}</mat-card-subtitle>
          </div>
        </mat-card-header>
        <mat-divider></mat-divider>
        <mat-card-content class="profile-content">
          <div class="detail-row">
            <span class="detail-label">Status</span>
            <span class="detail-value status-badge {{ userRecord.status }}">{{ userRecord.status | titlecase }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">SSID</span>
            <span class="detail-value">{{ userRecord.ssid || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">NIN</span>
            <span class="detail-value">{{ userRecord.nin || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Ministry</span>
            <span class="detail-value">{{ userRecord.ministry || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Department</span>
            <span class="detail-value">{{ userRecord.department || 'N/A' }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Grade Level</span>
            <span class="detail-value">{{ userRecord.gradeLevel || 'N/A' }}</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="actions-column">
      <mat-card *ngIf="userRecord.status === 'AWAITING_REVALIDATION'" class="action-card verification-required-card">
        <mat-card-header>
          <mat-icon mat-card-avatar color="warn">warning</mat-icon>
          <mat-card-title>Action Required</mat-card-title>
          <mat-card-subtitle>Please re-verify your identity</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p>Your record details have been updated. Please re-submit your SSID and NIN to continue.</p>
          <form [formGroup]="reverifyForm" (ngSubmit)="onReverifySubmit()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>SSID</mat-label>
              <input matInput formControlName="ssid">
            </mat-form-field>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>NIN</mat-label>
              <input matInput formControlName="nin">
            </mat-form-field>
            <button mat-flat-button class="primary-button" type="submit" [disabled]="reverifyForm.invalid || isLoading">
              <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
              <span *ngIf="!isLoading">Submit Re-verification</span>
            </button>
          </form>
          <div *ngIf="statusMessage" class="status-message">{{ statusMessage }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="action-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>account_balance</mat-icon>
          <mat-card-title>Access Loans</mat-card-title>
          <mat-card-subtitle>Future Feature</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p>Access financial services and loan opportunities based on your verified status.</p>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-flat-button disabled>Coming Soon</button>
        </mat-card-actions>
      </mat-card>

      <mat-card class="action-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>face</mat-icon>
          <mat-card-title>Liveness Check</mat-card-title>
          <mat-card-subtitle>Future Feature</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p>Complete your periodic "I Am Alive" verification digitally from anywhere.</p>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-flat-button disabled>Coming Soon</button>
        </mat-card-actions>
      </mat-card>
    </div>

  </div>
</div>

<ng-template #loading>
  <div class="spinner-container">
    <mat-spinner></mat-spinner>
    <p>Loading your record...</p>
  </div>
</ng-template>