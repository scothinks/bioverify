<!-- FILE: src/app/user-management/user-management.component.html -->

<div class="user-management-container">
  <mat-card *ngIf="tenant" class="user-management-card">
    <mat-card-header class="card-header">
      <div class="header-content">
        <mat-card-title class="title">
          <mat-icon class="tenant-icon">business</mat-icon>
          Manage Users for: {{ tenant.name }}
        </mat-card-title>
        <mat-card-subtitle class="subtitle">
          Create and manage tenant administrators
        </mat-card-subtitle>
      </div>
      <button 
        mat-icon-button 
        (click)="close.emit()" 
        aria-label="Close user management"
        class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </mat-card-header>

    <mat-card-content class="card-content">
      <!-- Create User Section -->
      <div class="section create-user-section">
        <div class="section-header">
          <h3 class="section-title">
            <mat-icon class="section-icon">person_add</mat-icon>
            Create New Tenant Admin
          </h3>
          <mat-divider></mat-divider>
        </div>

        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Full Name</mat-label>
              <input 
                matInput 
                formControlName="fullName"
                placeholder="Enter full name"
                autocomplete="name">
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="userForm.get('fullName')?.hasError('required')">
                Full name is required
              </mat-error>
              <mat-error *ngIf="userForm.get('fullName')?.hasError('minlength')">
                Name must be at least 2 characters long
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Email Address</mat-label>
              <input 
                matInput 
                formControlName="email" 
                type="email"
                placeholder="Enter email address"
                autocomplete="email">
              <mat-icon matSuffix>email</mat-icon>
              <mat-error *ngIf="userForm.get('email')?.hasError('required')">
                Email is required
              </mat-error>
              <mat-error *ngIf="userForm.get('email')?.hasError('email')">
                Please enter a valid email address
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Password</mat-label>
              <input 
                matInput 
                formControlName="password" 
                [type]="hidePassword ? 'password' : 'text'"
                placeholder="Enter password"
                autocomplete="new-password">
              <button 
                mat-icon-button 
                matSuffix 
                (click)="hidePassword = !hidePassword"
                [attr.aria-label]="'Hide password'"
                [attr.aria-pressed]="hidePassword"
                type="button">
                <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
              </button>
              <mat-error *ngIf="userForm.get('password')?.hasError('required')">
                Password is required
              </mat-error>
              <mat-error *ngIf="userForm.get('password')?.hasError('minlength')">
                Password must be at least 8 characters long
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Role</mat-label>
              <mat-select formControlName="role">
                <mat-option *ngFor="let role of roles" [value]="role.value">
                  {{ role.label }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>admin_panel_settings</mat-icon>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button 
              mat-raised-button 
              color="primary" 
              type="submit" 
              [disabled]="userForm.invalid || isSubmitting"
              class="create-button">
              <mat-icon *ngIf="isSubmitting" class="loading-icon">refresh</mat-icon>
              <mat-icon *ngIf="!isSubmitting">person_add</mat-icon>
              {{ isSubmitting ? 'Creating...' : 'Create User' }}
            </button>
            <button 
              mat-button 
              type="button" 
              (click)="resetForm()"
              class="reset-button">
              <mat-icon>refresh</mat-icon>
              Reset
            </button>
          </div>
        </form>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="!tenant">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading tenant information...</p>
  </div>
</div>